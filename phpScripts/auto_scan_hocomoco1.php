#!/usr/bin/php


<?php													
	set_time_limit(0);
	//HOCOMOCO PWM
	//ACGT
	$p_value = [
	"AHR" => "5.864" , "AIRE" => "56.201" , "ALX1" => "55.441" , "ALX3" => "43.663" , "ALX4" => "-10.118" , "ANDR" => "53.051" , "AP2A" => "50.761" , "AP2B" => "57.001" , "AP2C" => "48.401" , "AP2D" => "55.291" , "ARI3A" => "42.681" , "ARI3A" => "49.065" , "ARI5B" => "55.461" , "ARNT2" => "56.231" , "ARNT" => "6.402" , "ARX" => "30.741" , "ASCL2" => "56.871" , "ATF1" => "59.531" , "ATF2" => "5.6" , "ATF3" => "60.687" , "ATF6A" => "52.374" , "ATF7" => "-0.0918" , "ATOH1" => "56.081" , "BACH1" => "50.111" , "BARH1" => "47.291" , "BARH2" => "47.091" , "BARX1" => "-0.1469" , "BARX2" => "56.477" , "BATF3" => "56.651" , "BATF" => "50.581" , "BATF" => "50.593" , "BC11A" => "54.421" , "BCL6B" => "44.142" , "BCL6" => "55.971" , "BHA15" => "33.392" , "BHE22" => "16.691" , "BHE23" => "57.001" , "BHE40" => "51.443" , "BHE41" => "55.251" , "BMAL1" => "52.071" , "BPTF" => "56.131" , "BRAC" => "0.2231" , "BRCA1" => "57.729" , "BSH" => "57.541" , "CDC5L" => "55.671" , "CDX1" => "54.847" , "CDX2" => "5.873" , "CEBPA" => "44.731" , "CEBPB" => "43.841" , "CEBPD" => "58.012" , "CEBPE" => "58.201" , "CEBPG" => "56.381" , "CEBPZ" => "52.692" , "CENPB" => "23.601" , "CLOCK" => "55.691" , "COE1" => "44.931" , "COT1" => "57.123" , "COT1" => "55.551" , "COT2" => "54.221" , "COT2" => "55.851" , "CPEB1" => "20.901" , "CR3L1" => "-34.012" , "CR3L2" => "43.931" , "CREB1" => "56.541" , "CREB3" => "41.391" , "CREB5" => "20.531" , "CREM" => "55.211" , "CRX" => "58.371" , "CTCFL" => "39.601" , "CTCF" => "37.721" , "CUX1" => "57.391" , "CUX2" => "37.861" , "CXXC1" => "53.287" , "DBP" => "55.841" , "DDIT3" => "55.581" , "DLX1" => "53.901" , "DLX2" => "53.734" , "DLX3" => "56.412" , "DLX4" => "43.001" , "DLX5" => "35.361" , "DLX6" => "55.521" , "DMBX1" => "54.081" , "DPRX" => "44.781" , "DRGX" => "18.882" , "DUXA" => "39.111" , "E2F1" => "55.371" , "E2F2" => "5.543" , "E2F3" => "56.195" , "E2F4" => "52.311" , "E2F5" => "57.744" , "E2F6" => "53.511" , "E2F7" => "54.216" , "E2F8" => "56.311" , "E4F1" => "55.266" , "EGR1" => "53.851" , "EGR1" => "47.641" , "EGR2" => "55.672" , "EGR3" => "55.771" , "EGR4" => "55.295" , "EHF" => "53.481" , "EHF" => "40.411" , "ELF1" => "49.851" , "ELF2" => "51.921" , "ELF3" => "55.121" , "ELF5" => "57.703" , "ELK1" => "57.782" , "ELK3" => "56.121" , "ELK4" => "57.201" , "EMX1" => "50.051" , "EMX2" => "50.511" , "EOMES" => "55.881" , "EPAS1" => "55.981" , "ERF" => "55.571" , "ERG" => "27.521" , "ERR1" => "54.121" , "ERR2" => "50.533" , "ERR3" => "55.575" , "ESR1" => "53.651" , "ESR1" => "50.271" , "ESR2" => "49.861" , "ESR2" => "56.554" , "ESX1" => "38.571" , "ETS1" => "59.185" , "ETS2" => "57.072" , "ETV1" => "45.401" , "ETV2" => "54.661" , "ETV3" => "55.411" , "ETV4" => "57.393" , "ETV5" => "55.671" , "ETV6" => "47.731" , "ETV7" => "53.821" , "EVI1" => "41.441" , "EVX1" => "51.811" , "EVX2" => "53.191" , "FEV" => "56.521" , "FIGLA" => "56.051" , "FLI1" => "48.961" , "FOSB" => "41.581" , "FOSL1" => "44.491" , "FOSL2" => "44.081" , "FOS" => "46.041" , "FOXA1" => "49.551" , "FOXA2" => "50.081" , "FOXA3" => "56.641" , "FOXB1" => "31.911" , "FOXC1" => "50.391" , "FOXC2" => "55.271" , "FOXD1" => "55.411" , "FOXD2" => "13.081" , "FOXD3" => "53.452" , "FOXF1" => "55.883" , "FOXF2" => "55.772" , "FOXG1" => "49.501" , "FOXH1" => "49.064" , "FOXI1" => "36.902" , "FOXJ2" => "55.011" , "FOXJ3" => "27.321" , "FOXJ3" => "27.131" , "FOXK1" => "57.761" , "FOXL1" => "-43.119" , "FOXM1" => "55.531" , "FOXO1" => "54.831" , "FOXO3" => "55.841" , "FOXO4" => "56.642" , "FOXO6" => "40.961" , "FOXP2" => "58.054" , "FOXP3" => "55.513" , "FOXQ1" => "53.865" , "FUBP1" => "56.551" , "GABP1" => "57.211" , "GABPA" => "38.851" , "GATA1" => "50.861" , "GATA1" => "50.551" , "GATA2" => "54.841" , "GATA3" => "57.341" , "GATA4" => "59.816" , "GATA5" => "56.381" , "GATA6" => "47.881" , "GATA6" => "5.862" , "GBX1" => "43.641" , "GBX2" => "50.821" , "GCM1" => "56.391" , "GCM2" => "43.202" , "GCR" => "48.381" , "GCR" => "5.987" , "GFI1B" => "54.591" , "GFI1" => "57.222" , "GLI1" => "54.101" , "GLI2" => "-0.3509" , "GLI3" => "56.553" , "GLIS1" => "46.991" , "GLIS2" => "25.081" , "GLIS3" => "55.531" , "GMEB2" => "61.471" , "GRHL1" => "51.891" , "GSC2" => "58.171" , "GSC" => "51.412" , "GSX1" => "56.211" , "GSX2" => "53.261" , "HAND1" => "56.571" , "HBP1" => "55.614" , "HEN1" => "37.921" , "HES1" => "56.641" , "HES5" => "0.6091" , "HES7" => "14.981" , "HESX1" => "55.691" , "HEY1" => "49.741" , "HEY2" => "55.211" , "HIC1" => "55.831" , "HIC2" => "52.881" , "HIF1A" => "56.941" , "HINFP" => "51.821" , "HLF" => "55.031" , "HLTF" => "55.691" , "HMBX1" => "57.453" , "HME1" => "39.521" , "HME2" => "52.281" , "HMGA1" => "55.648" , "HMGA2" => "44.371" , "HMX1" => "47.311" , "HMX2" => "57.351" , "HMX3" => "54.301" , "HNF1A" => "51.401" , "HNF1B" => "54.191" , "HNF4A" => "49.371" , "HNF4G" => "51.051" , "HNF6" => "54.781" , "HOMEZ" => "43.731" , "HSF1" => "55.091" , "HSF2" => "55.251" , "HSF4" => "17.611" , "HSFY1" => "45.411" , "HTF4" => "55.381" , "HXA10" => "56.151" , "HXA11" => "57.611" , "HXA13" => "56.401" , "HXA1" => "55.751" , "HXA2" => "56.671" , "HXA5" => "57.093" , "HXA7" => "55.361" , "HXA9" => "51.061" , "HXB13" => "52.012" , "HXB1" => "51.689" , "HXB2" => "38.611" , "HXB3" => "55.621" , "HXB6" => "55.171" , "HXB7" => "53.221" , "HXB8" => "52.033" , "HXC10" => "55.771" , "HXC11" => "56.982" , "HXC12" => "55.551" , "HXC13" => "56.101" , "HXC6" => "48.031" , "HXC8" => "55.831" , "HXD10" => "55.091" , "HXD11" => "57.661" , "HXD12" => "60.331" , "HXD13" => "54.922" , "HXD3" => "58.781" , "HXD4" => "54.862" , "HXD8" => "58.861" , "HXD9" => "54.079" , "ID4" => "55.831" , "IKZF1" => "58.212" , "INSM1" => "48.714" , "IRF1" => "37.441" , "IRF2" => "46.781" , "IRF3" => "50.441" , "IRF4" => "53.371" , "IRF5" => "47.831" , "IRF7" => "56.571" , "IRF8" => "53.431" , "IRF9" => "54.955" , "IRX2" => "57.461" , "IRX3" => "59.931" , "ISL1" => "60.426" , "ISL2" => "58.241" , "ISX" => "42.261" , "ITF2" => "41.321" , "JDP2" => "25.601" , "JUNB" => "45.991" , "JUND" => "48.661" , "JUN" => "54.267" , "KAISO" => "50.551" , "KAISO" => "52.171" , "KLF12" => "54.341" , "KLF13" => "20.601" , "KLF14" => "31.801" , "KLF15" => "55.421" , "KLF16" => "46.351" , "KLF1" => "56.244" , "KLF3" => "55.671" , "KLF4" => "52.455" , "KLF6" => "55.498" , "KLF8" => "56.679" , "LBX2" => "48.891" , "LEF1" => "54.887" , "LHX2" => "55.891" , "LHX3" => "46.591" , "LHX4" => "61.461" , "LHX6" => "34.551" , "LHX8" => "36.591" , "LHX9" => "38.551" , "LMX1A" => "49.861" , "LMX1B" => "51.941" , "MAFA" => "54.431" , "MAFB" => "57.035" , "MAFF" => "22.661" , "MAFG" => "30.341" , "MAFG" => "60.927" , "MAFK" => "29.571" , "MAFK" => "54.056" , "MAF" => "57.144" , "MAX" => "51.122" , "MAZ" => "30.721" , "MBD2" => "53.622" , "MCR" => "55.571" , "MECP2" => "52.007" , "MEF2A" => "49.041" , "MEF2B" => "27.871" , "MEF2C" => "51.081" , "MEF2D" => "55.263" , "MEIS1" => "52.651" , "MEIS2" => "35.521" , "MEIS3" => "53.671" , "MEOX1" => "50.611" , "MEOX2" => "56.501" , "MESP1" => "56.261" , "MGAP" => "27.161" , "MITF" => "57.791" , "MIXL1" => "57.161" , "MLXPL" => "53.301" , "MLX" => "10.953" , "MNT" => "55.961" , "MNX1" => "55.371" , "MSX1" => "33.451" , "MSX2" => "55.376" , "MTF1" => "48.311" , "MUSC" => "0.7662" , "MYBA" => "55.771" , "MYBB" => "52.843" , "MYB" => "61.542" , "MYCN" => "57.408" , "MYC" => "53.161" , "MYF6" => "53.703" , "MYOD1" => "57.484" , "MYOG" => "54.201" , "MZF1" => "56.531" , "NANOG" => "51.781" , "NANOG" => "57.651" , "NDF1" => "56.601" , "NDF2" => "54.301" , "NF2L1" => "59.234" , "NF2L2" => "55.401" , "NFAC1" => "52.931" , "NFAC1" => "37.631" , "NFAC2" => "55.355" , "NFAC3" => "56.796" , "NFAC4" => "57.075" , "NFAT5" => "54.611" , "NFE2" => "49.351" , "NFIA" => "54.851" , "NFIA" => "61.127" , "NFIC" => "52.111" , "NFIL3" => "52.541" , "NFKB1" => "50.971" , "NFKB2" => "55.651" , "NFYA" => "47.661" , "NFYB" => "44.301" , "NFYC" => "55.891" , "NGN2" => "56.541" , "NKX21" => "57.132" , "NKX22" => "55.441" , "NKX23" => "56.521" , "NKX25" => "57.404" , "NKX28" => "54.972" , "NKX31" => "55.611" , "NKX32" => "56.811" , "NKX61" => "45.861" , "NKX62" => "58.791" , "NOBOX" => "56.313" , "NOTO" => "54.771" , "NR0B1" => "55.292" , "NR1D1" => "53.761" , "NR1H2" => "21.142" , "NR1H4" => "52.071" , "NR1I2" => "53.381" , "NR1I2" => "58.648" , "NR1I3" => "52.271" , "NR1I3" => "60.314" , "NR2C1" => "55.591" , "NR2C2" => "54.231" , "NR2E1" => "41.061" , "NR2E3" => "53.711" , "NR2F6" => "55.641" , "NR4A1" => "57.373" , "NR4A2" => "56.042" , "NR4A3" => "55.529" , "NR5A2" => "56.101" , "NR6A1" => "43.541" , "NRF1" => "28.071" , "NRL" => "57.261" , "OLIG1" => "10.011" , "OLIG2" => "50.472" , "OLIG3" => "40.421" , "ONEC2" => "53.311" , "ONEC3" => "38.221" , "OTX1" => "56.372" , "OTX2" => "56.401" , "OVOL1" => "55.154" , "P53" => "37.001" , "P5F1B" => "38.001" , "P63" => "44.861" , "P63" => "56.761" , "P73" => "41.671" , "P73" => "56.311" , "PAX1" => "30.651" , "PAX2" => "55.981" , "PAX2" => "58.949" , "PAX3" => "-22.898" , "PAX4" => "58.261" , "PAX5" => "52.761" , "PAX5" => "60.522" , "PAX6" => "55.521" , "PAX7" => "19.232" , "PAX8" => "54.681" , "PBX1" => "54.751" , "PBX2" => "55.861" , "PBX3" => "53.851" , "PDX1" => "55.228" , "PEBB" => "56.891" , "PHX2A" => "31.682" , "PHX2B" => "39.332" , "PIT1" => "56.301" , "PITX1" => "50.771" , "PITX2" => "56.383" , "PITX3" => "41.321" , "PKNX1" => "56.171" , "PKNX2" => "56.721" , "PLAG1" => "54.221" , "PLAG1" => "56.871" , "PLAL1" => "56.343" , "PO2F1" => "55.973" , "PO2F2" => "22.101" , "PO2F3" => "55.881" , "PO3F1" => "55.901" , "PO3F2" => "57.651" , "PO3F3" => "54.771" , "PO3F4" => "37.071" , "PO4F1" => "29.601" , "PO4F2" => "54.091" , "PO4F3" => "13.121" , "PO5F1" => "47.801" , "PO6F1" => "49.592" , "PO6F2" => "47.621" , "PPARA" => "53.041" , "PPARA" => "56.741" , "PPARD" => "55.361" , "PPARG" => "52.281" , "PPARG" => "57.836" , "PRD14" => "52.851" , "PRDM1" => "40.481" , "PRDM4" => "14.911" , "PRGR" => "56.381" , "PRGR" => "58.473" , "PROP1" => "55.581" , "PROX1" => "56.311" , "PRRX1" => "51.909" , "PRRX2" => "54.824" , "PTF1A" => "54.471" , "PURA" => "55.621" , "RARA" => "54.661" , "RARA" => "46.405" , "RARB" => "55.161" , "RARG" => "55.011" , "RARG" => "57.756" , "RAX2" => "52.681" , "RELB" => "56.221" , "REL" => "56.351" , "REST" => "15.811" , "RFX1" => "55.941" , "RFX2" => "31.761" , "RFX3" => "23.411" , "RFX4" => "36.911" , "RFX5" => "53.271" , "RHXF1" => "59.681" , "RORA" => "42.862" , "RORG" => "55.201" , "RREB1" => "47.131" , "RUNX1" => "51.642" , "RUNX2" => "57.072" , "RUNX3" => "51.511" , "RXRA" => "53.711" , "RXRB" => "56.155" , "RXRG" => "24.471" , "RX" => "50.601" , "SCRT1" => "43.591" , "SCRT2" => "15.981" , "SHOX2" => "16.581" , "SHOX" => "21.021" , "SMAD1" => "55.811" , "SMAD2" => "54.711" , "SMAD3" => "57.492" , "SMAD4" => "53.621" , "SMRC1" => "53.981" , "SNAI1" => "56.243" , "SNAI2" => "49.734" , "SOX10" => "5.651" , "SOX11" => "29.961" , "SOX13" => "53.778" , "SOX15" => "54.281" , "SOX17" => "38.441" , "SOX18" => "55.771" , "SOX1" => "40.281" , "SOX21" => "36.251" , "SOX2" => "49.371" , "SOX3" => "41.161" , "SOX4" => "55.413" , "SOX5" => "55.689" , "SOX7" => "-0.0399" , "SOX8" => "40.591" , "SOX9" => "52.311" , "SP1" => "46.761" , "SP1" => "50.771" , "SP2" => "46.171" , "SP3" => "51.511" , "SP4" => "40.191" , "SPDEF" => "57.541" , "SPI1" => "25.521" , "SPIB" => "51.711" , "SPIC" => "56.241" , "SPZ1" => "55.701" , "SRBP1" => "57.261" , "SRBP2" => "57.201" , "SRF" => "53.041" , "SRY" => "57.015" , "STA5A" => "51.823" , "STA5B" => "50.561" , "STAT1" => "35.561" , "STAT1" => "46.451" , "STAT2" => "52.051" , "STAT3" => "52.611" , "STAT4" => "55.451" , "STAT6" => "55.841" , "STF1" => "56.931" , "SUH" => "56.171" , "TAL1" => "52.661" , "TAL1" => "47.101" , "TBP" => "56.832" , "TBR1" => "42.581" , "TBX15" => "43.591" , "TBX19" => "18.491" , "TBX1" => "31.091" , "TBX20" => "53.201" , "TBX21" => "46.191" , "TBX2" => "52.971" , "TBX3" => "50.381" , "TBX4" => "46.091" , "TBX5" => "57.117" , "TCF7" => "56.161" , "TEAD1" => "56.521" , "TEAD3" => "56.151" , "TEAD4" => "53.541" , "TEF" => "55.891" , "TF2LX" => "54.291" , "TF65" => "45.001" , "TF7L1" => "55.921" , "TF7L2" => "54.021" , "TFAP4" => "56.021" , "TFCP2" => "55.921" , "TFDP1" => "48.911" , "TFDP1" => "55.701" , "TFE2" => "55.791" , "TFE3" => "56.701" , "TFEB" => "40.289" , "TGIF1" => "55.191" , "TGIF1" => "58.684" , "TGIF2" => "51.021" , "THAP1" => "50.271" , "THA" => "55.471" , "THA" => "56.951" , "THB" => "53.811" , "THB" => "56.215" , "TLX1" => "55.931" , "TLX1" => "56.681" , "TWST1" => "56.451" , "TYY1" => "47.351" , "TYY2" => "45.433" , "UBIP1" => "54.859" , "UNC4" => "33.201" , "USF1" => "37.861" , "USF2" => "37.991" , "VAX1" => "44.091" , "VAX2" => "54.841" , "VDR" => "54.141" , "VDR" => "56.317" , "VENTX" => "51.971" , "VSX1" => "50.251" , "VSX2" => "53.702" , "WT1" => "55.011" , "XBP1" => "27.071" , "YBOX1" => "55.662" , "ZBED1" => "-35.399" , "ZBT18" => "51.221" , "ZBT49" => "60.451" , "ZBT7A" => "56.631" , "ZBT7B" => "35.311" , "ZBTB4" => "42.141" , "ZBTB4" => "54.011" , "ZBTB6" => "51.921" , "ZEB1" => "56.944" , "ZEP1" => "55.562" , "ZEP2" => "55.611" , "ZFHX3" => "55.901" , "ZFX" => "46.031" , "ZIC1" => "5.616" , "ZIC2" => "5.425" , "ZIC3" => "54.502" , "ZIC4" => "31.081" , "ZKSC1" => "36.161" , "ZKSC3" => "55.281" , "ZN143" => "48.371" , "ZN148" => "52.701" , "ZN219" => "54.991" , "ZN232" => "20.971" , "ZN282" => "55.931" , "ZN333" => "56.963" , "ZN350" => "51.801" , "ZN384" => "54.901" , "ZN410" => "-0.8489" , "ZN423" => "26.155" , "ZN524" => "43.651" , "ZN589" => "55.071" , "ZN639" => "51.851" , "ZN652" => "53.963" , "ZN713" => "51.771" , "ZN740" => "44.741" , "ZN784" => "56.561" , "ZSC16" => "45.271" , "ZSCA4" => "-0.4053"
	];
	$gene = '';
	$seq = '';
	
	$arq_seq = '';
	$fasta = fopen('a1.txt', "r") or die("Ops! =/");
	while(!feof($fasta)) {			
		$arq_seq .= fgets($fasta);
	}
	fclose($fasta);
	
	$sequencias = explode('>',$arq_seq);
	//PWM
	$matrix = '';				
	$arq = fopen('pwms_HUMAN_mono.txt', "r") or die("Ops! =/");
	while(!feof($arq)) {
		$matrix .= fgets($arq);
	}
	fclose($arq);			
	$matrix = urlencode($matrix);				
	$matrix = str_replace(array('.A','.B','.C','.D','.S','_HUMAN.H10MO'),'',$matrix);
	$matrixmotif = explode('%3E',$matrix);

	for($x = 1; $x < count($sequencias); $x++){
		//para cada matriz 
		for($i = 1; $i < count($matrixmotif); $i++){
			//quebra de linha
			$linha = explode('%0A',$matrixmotif[$i]);
			$fator_de_transcricao = $linha[0];
			$tamanho_motif = ((count($linha))-2);

			//para cada linha
			for($j = 1; $j <= $tamanho_motif; $j++){
				//espaço
				$base_nitrogenadas = explode('%09',$linha[$j]);	
				$base[$j]['A'] = round($base_nitrogenadas[0],3);
				$base[$j]['C'] = round($base_nitrogenadas[1],3);
				$base[$j]['G'] = round($base_nitrogenadas[2],3);
				$base[$j]['T'] = round($base_nitrogenadas[3],3);
			}

			$fast_seq = explode('%0A',urlencode($sequencias[$x]));		
			$gene = trim($fast_seq[0]);
			$seq = strtoupper(trim($fast_seq[1]));	
			$tseq = strlen($seq);

			for($b = 0; $b < $tseq; $b++){
				if(($tseq-$b)>=$tamanho_motif){
					$motif[$b] = substr($seq, $b, $tamanho_motif);
				}	
			}

			foreach ($motif as $mtfs) {
				$score = 0;				
				for($p = 0; $p < $tamanho_motif; $p++){
					$base_p = substr($mtfs, $p, 1);
					$score += $base[$p+1][$base_p];
				}
				if($score>=$p_value[$fator_de_transcricao]){
					//echo $fator_de_transcricao.';'.$p_value[$fator_de_transcricao].';'.$gene.';'.$mtfs.';'.$score.'<br/>';
					echo $fator_de_transcricao.';'.$gene.PHP_EOL;
				}
			}
			unset($base);
			unset($motif);
			unset($gene);
			unset($seq);
		}
	}
?>
